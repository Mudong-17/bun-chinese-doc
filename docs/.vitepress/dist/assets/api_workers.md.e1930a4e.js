import{_ as s,o as a,c as n,Q as o}from"./chunks/framework.33544f09.js";const k=JSON.parse('{"title":"Workers","description":"","frontmatter":{"outline":"deep"},"headers":[],"relativePath":"api/workers.md","filePath":"api/workers.md"}'),l={name:"api/workers.md"},e=o(`<h1 id="workers" tabindex="-1">Workers <a class="header-anchor" href="#workers" aria-label="Permalink to &quot;Workers&quot;">â€‹</a></h1><blockquote><p><strong>ğŸš§</strong> â€” <code>Worker</code> API ä»å¤„äºå®éªŒé˜¶æ®µï¼Œä¸åº”è§†ä¸ºç”Ÿäº§å°±ç»ªã€‚</p></blockquote><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Worker" target="_blank" rel="noreferrer"><code>Worker</code></a> å…è®¸æ‚¨åœ¨å•ç‹¬çš„çº¿ç¨‹ä¸Šå¯åŠ¨å¹¶ä¸æ–°çš„ JavaScript å®ä¾‹è¿›è¡Œé€šä¿¡ï¼ŒåŒæ—¶ä¸ä¸»çº¿ç¨‹å…±äº« I/O èµ„æºã€‚</p><p>Bun å®ç°äº†<a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API" target="_blank" rel="noreferrer">Web Workers API</a>çš„æœ€å°ç‰ˆæœ¬ï¼Œå¹¶å…·æœ‰ä½¿å…¶åœ¨æœåŠ¡å™¨ç«¯ç”¨ä¾‹ä¸­æ›´å¥½åœ°å·¥ä½œçš„æ‰©å±•åŠŸèƒ½ã€‚ä¸ Bun çš„å…¶ä»–éƒ¨åˆ†ä¸€æ ·ï¼ŒBun ä¸­çš„<code>Worker</code>æ”¯æŒ CommonJSã€ES æ¨¡å—ã€TypeScriptã€JSXã€TSX ç­‰ï¼Œæ— éœ€é¢å¤–çš„æ„å»ºæ­¥éª¤ã€‚</p><h2 id="åˆ›å»ºä¸€ä¸ªworker" tabindex="-1">åˆ›å»ºä¸€ä¸ª<code>Worker</code> <a class="header-anchor" href="#åˆ›å»ºä¸€ä¸ªworker" aria-label="Permalink to &quot;åˆ›å»ºä¸€ä¸ª\`Worker\`&quot;">â€‹</a></h2><p>ä¸æµè§ˆå™¨ä¸­ä¸€æ ·ï¼Œ<a href="https://developer.mozilla.org/en-US/docs/Web/API/Worker" target="_blank" rel="noreferrer"><code>Worker</code></a> æ˜¯å…¨å±€çš„ã€‚å¯ä»¥ä½¿ç”¨å®ƒåˆ›å»ºä¸€ä¸ªæ–°çš„å·¥ä½œçº¿ç¨‹ã€‚</p><h3 id="ä»ä¸»çº¿ç¨‹" tabindex="-1">ä»ä¸»çº¿ç¨‹ <a class="header-anchor" href="#ä»ä¸»çº¿ç¨‹" aria-label="Permalink to &quot;ä»ä¸»çº¿ç¨‹&quot;">â€‹</a></h3><div class="language-js#Main_thread vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js#Main_thread</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">const workerURL = new URL(&quot;worker.ts&quot;, i<wbr>mport.meta.url).href;</span></span>
<span class="line"><span style="color:#e1e4e8;">const worker = new Worker(workerURL);</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">worker.postMessage(&quot;hello&quot;);</span></span>
<span class="line"><span style="color:#e1e4e8;">worker.onmessage = event =&gt; {</span></span>
<span class="line"><span style="color:#e1e4e8;">  console.log(event.data);</span></span>
<span class="line"><span style="color:#e1e4e8;">};</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">const workerURL = new URL(&quot;worker.ts&quot;, i<wbr>mport.meta.url).href;</span></span>
<span class="line"><span style="color:#24292e;">const worker = new Worker(workerURL);</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">worker.postMessage(&quot;hello&quot;);</span></span>
<span class="line"><span style="color:#24292e;">worker.onmessage = event =&gt; {</span></span>
<span class="line"><span style="color:#24292e;">  console.log(event.data);</span></span>
<span class="line"><span style="color:#24292e;">};</span></span></code></pre></div><h3 id="å·¥ä½œçº¿ç¨‹" tabindex="-1">å·¥ä½œçº¿ç¨‹ <a class="header-anchor" href="#å·¥ä½œçº¿ç¨‹" aria-label="Permalink to &quot;å·¥ä½œçº¿ç¨‹&quot;">â€‹</a></h3><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">// é˜²æ­¢TSé”™è¯¯</span></span>
<span class="line"><span style="color:#F97583;">declare</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> self</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Worker</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">self.</span><span style="color:#B392F0;">onmessage</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> (</span><span style="color:#FFAB70;">event</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">MessageEvent</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(event.data);</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">postMessage</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;world&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">};</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// é˜²æ­¢TSé”™è¯¯</span></span>
<span class="line"><span style="color:#D73A49;">declare</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">var</span><span style="color:#24292E;"> self</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Worker</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">self.</span><span style="color:#6F42C1;">onmessage</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> (</span><span style="color:#E36209;">event</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">MessageEvent</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(event.data);</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">postMessage</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;world&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">};</span></span></code></pre></div><p>ä¸ºäº†åœ¨ä½¿ç”¨<code>self</code>æ—¶é˜²æ­¢ TypeScript é”™è¯¯ï¼Œè¯·åœ¨å·¥ä½œæ–‡ä»¶çš„é¡¶éƒ¨æ·»åŠ è¿™ä¸€è¡Œã€‚</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">declare</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> self</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Worker</span><span style="color:#E1E4E8;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">declare</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">var</span><span style="color:#24292E;"> self</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Worker</span><span style="color:#24292E;">;</span></span></code></pre></div><p>æ‚¨å¯ä»¥åœ¨å·¥ä½œä»£ç ä¸­ä½¿ç”¨<code>import</code>å’Œ<code>export</code>è¯­æ³•ã€‚ä¸æµè§ˆå™¨ä¸åŒï¼Œæ— éœ€æŒ‡å®š<code>{type: &quot;module&quot;}</code>ä»¥ä½¿ç”¨ ES æ¨¡å—ã€‚</p><p>ä¸ºäº†ç®€åŒ–é”™è¯¯å¤„ç†ï¼Œåœ¨è°ƒç”¨<code>new Worker(url)</code>æ—¶ï¼Œåˆå§‹è„šæœ¬å°†åœ¨è§£ææ—¶åŠ è½½ã€‚</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">worker</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Worker</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;/not-found.js&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#6A737D;">// ç«‹å³å¼•å‘é”™è¯¯</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">worker</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Worker</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;/not-found.js&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#6A737D;">// ç«‹å³å¼•å‘é”™è¯¯</span></span></code></pre></div><p>ä¼ é€’ç»™<code>Worker</code>çš„ specifier æ˜¯ç›¸å¯¹äºé¡¹ç›®æ ¹ç›®å½•è§£æçš„ï¼ˆå°±åƒè¾“å…¥<code>bun ./path/to/file.js</code>ä¸€æ ·ï¼‰ã€‚</p><h3 id="open" tabindex="-1"><code>&quot;open&quot;</code> <a class="header-anchor" href="#open" aria-label="Permalink to &quot;\`&quot;open&quot;\`&quot;">â€‹</a></h3><p>åœ¨åˆ›å»ºå·¥ä½œçº¿ç¨‹å¹¶å‡†å¤‡æ¥æ”¶æ¶ˆæ¯æ—¶ï¼Œä¼šè§¦å‘<code>&quot;open&quot;</code>äº‹ä»¶ã€‚å¯ä»¥åœ¨å·¥ä½œçº¿ç¨‹å‡†å¤‡å°±ç»ªåå‘é€åˆå§‹æ¶ˆæ¯ã€‚ ï¼ˆåœ¨æµè§ˆå™¨ä¸­ä¸å­˜åœ¨æ­¤äº‹ä»¶ã€‚ï¼‰</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">worker</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Worker</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">URL</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;worker.ts&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">import</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">meta</span><span style="color:#E1E4E8;">.url).href);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">worker.</span><span style="color:#B392F0;">addEventListener</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;open&quot;</span><span style="color:#E1E4E8;">, () </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;worker is ready&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">worker</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Worker</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">URL</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;worker.ts&quot;</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">import</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">meta</span><span style="color:#24292E;">.url).href);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">worker.</span><span style="color:#6F42C1;">addEventListener</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;open&quot;</span><span style="color:#24292E;">, () </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;worker is ready&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">});</span></span></code></pre></div><p>æ¶ˆæ¯ä¼šè‡ªåŠ¨æ’é˜Ÿï¼Œç›´åˆ°å·¥ä½œçº¿ç¨‹å‡†å¤‡å°±ç»ªï¼Œå› æ­¤æ— éœ€ç­‰å¾…<code>&quot;open&quot;</code>äº‹ä»¶æ¥å‘é€æ¶ˆæ¯ã€‚</p><h2 id="ä½¿ç”¨postmessageå‘é€æ¶ˆæ¯" tabindex="-1">ä½¿ç”¨<code>postMessage</code>å‘é€æ¶ˆæ¯ <a class="header-anchor" href="#ä½¿ç”¨postmessageå‘é€æ¶ˆæ¯" aria-label="Permalink to &quot;ä½¿ç”¨\`postMessage\`å‘é€æ¶ˆæ¯&quot;">â€‹</a></h2><p>è¦å‘é€æ¶ˆæ¯ï¼Œä½¿ç”¨<a href="https://developer.mozilla.org/en-US/docs/Web/API/Worker/postMessage" target="_blank" rel="noreferrer"><code>worker.postMessage</code></a> å’Œ <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage" target="_blank" rel="noreferrer"><code>self.postMessage</code></a>ã€‚è¿™åˆ©ç”¨äº†<a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Structured_clone_algorithm" target="_blank" rel="noreferrer">HTML ç»“æ„åŒ–å…‹éš†ç®—æ³•</a>ã€‚</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">// åœ¨å·¥ä½œçº¿ç¨‹ä¸Šï¼Œ\`postMessage\`ä¼šè‡ªåŠ¨â€œè·¯ç”±â€åˆ°çˆ¶çº¿ç¨‹ã€‚</span></span>
<span class="line"><span style="color:#B392F0;">postMessage</span><span style="color:#E1E4E8;">({ hello: </span><span style="color:#9ECBFF;">&quot;world&quot;</span><span style="color:#E1E4E8;"> });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// åœ¨ä¸»çº¿ç¨‹ä¸Š</span></span>
<span class="line"><span style="color:#E1E4E8;">worker.</span><span style="color:#B392F0;">postMessage</span><span style="color:#E1E4E8;">({ hello: </span><span style="color:#9ECBFF;">&quot;world&quot;</span><span style="color:#E1E4E8;"> });</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// åœ¨å·¥ä½œçº¿ç¨‹ä¸Šï¼Œ\`postMessage\`ä¼šè‡ªåŠ¨â€œè·¯ç”±â€åˆ°çˆ¶çº¿ç¨‹ã€‚</span></span>
<span class="line"><span style="color:#6F42C1;">postMessage</span><span style="color:#24292E;">({ hello: </span><span style="color:#032F62;">&quot;world&quot;</span><span style="color:#24292E;"> });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// åœ¨ä¸»çº¿ç¨‹ä¸Š</span></span>
<span class="line"><span style="color:#24292E;">worker.</span><span style="color:#6F42C1;">postMessage</span><span style="color:#24292E;">({ hello: </span><span style="color:#032F62;">&quot;world&quot;</span><span style="color:#24292E;"> });</span></span></code></pre></div><p>è¦æ¥æ”¶æ¶ˆæ¯ï¼Œä½¿ç”¨å·¥ä½œçº¿ç¨‹å’Œä¸»çº¿ç¨‹ä¸Šçš„<a href="https://developer.mozilla.org/en-US/docs/Web/API/Worker/message_event" target="_blank" rel="noreferrer"><code>message</code>äº‹ä»¶å¤„ç†ç¨‹åº</a>ã€‚</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">// å·¥ä½œçº¿ç¨‹ï¼š</span></span>
<span class="line"><span style="color:#E1E4E8;">self.</span><span style="color:#B392F0;">addEventListener</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;message&quot;</span><span style="color:#E1E4E8;">, (</span><span style="color:#FFAB70;">event</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(event.data);</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span>
<span class="line"><span style="color:#6A737D;">// æˆ–ä½¿ç”¨setterï¼š</span></span>
<span class="line"><span style="color:#6A737D;">// self.onmessage = fn</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// å¦‚æœåœ¨ä¸»çº¿ç¨‹ä¸Š</span></span>
<span class="line"><span style="color:#E1E4E8;">worker.</span><span style="color:#B392F0;">addEventListener</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;message&quot;</span><span style="color:#E1E4E8;">, (</span><span style="color:#FFAB70;">event</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(event.data);</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span>
<span class="line"><span style="color:#6A737D;">// æˆ–ä½¿ç”¨setterï¼š</span></span>
<span class="line"><span style="color:#6A737D;">// worker.onmessage = fn</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// å·¥ä½œçº¿ç¨‹ï¼š</span></span>
<span class="line"><span style="color:#24292E;">self.</span><span style="color:#6F42C1;">addEventListener</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;message&quot;</span><span style="color:#24292E;">, (</span><span style="color:#E36209;">event</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(event.data);</span></span>
<span class="line"><span style="color:#24292E;">});</span></span>
<span class="line"><span style="color:#6A737D;">// æˆ–ä½¿ç”¨setterï¼š</span></span>
<span class="line"><span style="color:#6A737D;">// self.onmessage = fn</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// å¦‚æœåœ¨ä¸»çº¿ç¨‹ä¸Š</span></span>
<span class="line"><span style="color:#24292E;">worker.</span><span style="color:#6F42C1;">addEventListener</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;message&quot;</span><span style="color:#24292E;">, (</span><span style="color:#E36209;">event</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(event.data);</span></span>
<span class="line"><span style="color:#24292E;">});</span></span>
<span class="line"><span style="color:#6A737D;">// æˆ–ä½¿ç”¨setterï¼š</span></span>
<span class="line"><span style="color:#6A737D;">// worker.onmessage = fn</span></span></code></pre></div><h2 id="ç»ˆæ­¢å·¥ä½œçº¿ç¨‹" tabindex="-1">ç»ˆæ­¢å·¥ä½œçº¿ç¨‹ <a class="header-anchor" href="#ç»ˆæ­¢å·¥ä½œçº¿ç¨‹" aria-label="Permalink to &quot;ç»ˆæ­¢å·¥ä½œçº¿ç¨‹&quot;">â€‹</a></h2><p><code>Worker</code>å®ä¾‹åœ¨å…¶äº‹ä»¶å¾ªç¯æ²¡æœ‰å‰©ä½™å·¥ä½œæ—¶ä¼šè‡ªåŠ¨ç»ˆæ­¢ã€‚å°†å…¨å±€æˆ–ä»»ä½•<code>MessagePort</code>ä¸Šé™„åŠ <code>&quot;message&quot;</code>ç›‘å¬å™¨å°†ä½¿äº‹ä»¶å¾ªç¯ä¿æŒæ´»åŠ¨çŠ¶æ€ã€‚è¦å¼ºåˆ¶ç»ˆæ­¢<code>Worker</code>ï¼Œè¯·è°ƒç”¨<code>worker.terminate()</code>ã€‚</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">worker</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Worker</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">URL</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;worker.ts&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">import</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">meta</span><span style="color:#E1E4E8;">.url).href);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// ...ç¨å</span></span>
<span class="line"><span style="color:#E1E4E8;">worker.</span><span style="color:#B392F0;">terminate</span><span style="color:#E1E4E8;">();</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">worker</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Worker</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">URL</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;worker.ts&quot;</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">import</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">meta</span><span style="color:#24292E;">.url).href);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// ...ç¨å</span></span>
<span class="line"><span style="color:#24292E;">worker.</span><span style="color:#6F42C1;">terminate</span><span style="color:#24292E;">();</span></span></code></pre></div><p>è¿™å°†å¯¼è‡´å·¥ä½œçº¿ç¨‹å°½å¿«é€€å‡ºã€‚</p><h3 id="process-exit" tabindex="-1"><code>process.exit()</code> <a class="header-anchor" href="#process-exit" aria-label="Permalink to &quot;\`process.exit()\`&quot;">â€‹</a></h3><p>å·¥ä½œçº¿ç¨‹å¯ä»¥ä½¿ç”¨<code>process.exit()</code>è‡ªè¡Œç»ˆæ­¢ã€‚è¿™ä¸ä¼šç»ˆæ­¢ä¸»è¿›ç¨‹ã€‚ä¸ Node.js ä¸€æ ·ï¼Œåœ¨å·¥ä½œçº¿ç¨‹ä¸Šå‘å‡º<code>process.on(&#39;beforeExit&#39;, callback)</code>å’Œ<code>process.on(&#39;exit&#39;, callback)</code>äº‹ä»¶ï¼ˆè€Œä¸æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸Šï¼‰ï¼Œå¹¶å°†é€€å‡ºä»£ç ä¼ é€’ç»™<code>&quot;close&quot;</code>äº‹ä»¶ã€‚</p><h3 id="close" tabindex="-1"><code>&quot;close&quot;</code> <a class="header-anchor" href="#close" aria-label="Permalink to &quot;\`&quot;close&quot;\`&quot;">â€‹</a></h3><p>åœ¨å·¥ä½œçº¿ç¨‹å·²è¢«ç»ˆæ­¢æ—¶ï¼Œä¼šè§¦å‘<code>&quot;close&quot;</code>äº‹ä»¶ã€‚å·¥ä½œçº¿ç¨‹å®é™…ç»ˆæ­¢å¯èƒ½éœ€è¦ä¸€äº›æ—¶é—´ï¼Œå› æ­¤å½“å·¥ä½œçº¿ç¨‹è¢«æ ‡è®°ä¸ºå·²ç»ˆæ­¢æ—¶ä¼šè§¦å‘æ­¤äº‹ä»¶ã€‚<code>CloseEvent</code>å°†åŒ…å«ä¼ é€’ç»™<code>process.exit()</code>çš„é€€å‡ºä»£ç ï¼Œæˆ–è€…å¦‚æœç”±äºå…¶ä»–åŸå› è€Œå…³é—­ï¼Œåˆ™ä¸º 0ã€‚</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">worker</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Worker</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">URL</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;worker.ts&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">import</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">meta</span><span style="color:#E1E4E8;">.url).href);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">worker.</span><span style="color:#B392F0;">addEventListener</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;close&quot;</span><span style="color:#E1E4E8;">, (</span><span style="color:#FFAB70;">event</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;worker is being closed&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">worker</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Worker</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">URL</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;worker.ts&quot;</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">import</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">meta</span><span style="color:#24292E;">.url).href);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">worker.</span><span style="color:#6F42C1;">addEventListener</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;close&quot;</span><span style="color:#24292E;">, (</span><span style="color:#E36209;">event</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;worker is being closed&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">});</span></span></code></pre></div><p>åœ¨æµè§ˆå™¨ä¸­ä¸å­˜åœ¨æ­¤äº‹ä»¶ã€‚</p><h2 id="ç”Ÿå‘½å‘¨æœŸç®¡ç†" tabindex="-1">ç”Ÿå‘½å‘¨æœŸç®¡ç† <a class="header-anchor" href="#ç”Ÿå‘½å‘¨æœŸç®¡ç†" aria-label="Permalink to &quot;ç”Ÿå‘½å‘¨æœŸç®¡ç†&quot;">â€‹</a></h2><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ´»åŠ¨çš„<code>Worker</code>ä¼šä½¿ä¸»ï¼ˆç”Ÿæˆï¼‰è¿›ç¨‹ä¿æŒæ´»åŠ¨çŠ¶æ€ï¼Œå› æ­¤å¼‚æ­¥ä»»åŠ¡ï¼ˆå¦‚<code>setTimeout</code>å’Œ promisesï¼‰å°†ä½¿è¿›ç¨‹ä¿æŒæ´»åŠ¨çŠ¶æ€ã€‚é™„åŠ <code>message</code>ç›‘å¬å™¨ä¹Ÿä¼šä½¿<code>Worker</code>ä¿æŒæ´»åŠ¨çŠ¶æ€ã€‚</p><h3 id="worker-unref" tabindex="-1"><code>worker.unref()</code> <a class="header-anchor" href="#worker-unref" aria-label="Permalink to &quot;\`worker.unref()\`&quot;">â€‹</a></h3><p>è¦é˜»æ­¢è¿è¡Œä¸­çš„å·¥ä½œçº¿ç¨‹ä½¿è¿›ç¨‹ä¿æŒæ´»åŠ¨çŠ¶æ€ï¼Œè¯·è°ƒç”¨<code>worker.unref()</code>ã€‚è¿™ä¼šå°†å·¥ä½œçº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸä¸ä¸»è¿›ç¨‹çš„ç”Ÿå‘½å‘¨æœŸåˆ†ç¦»ï¼Œå¹¶ä¸ Node.js çš„<code>worker_threads</code>æ‰€åšçš„ç›¸åŒã€‚</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">worker</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Worker</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">URL</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;worker.ts&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">import</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">meta</span><span style="color:#E1E4E8;">.url).href);</span></span>
<span class="line"><span style="color:#E1E4E8;">worker.</span><span style="color:#B392F0;">unref</span><span style="color:#E1E4E8;">();</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">worker</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Worker</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">URL</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;worker.ts&quot;</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">import</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">meta</span><span style="color:#24292E;">.url).href);</span></span>
<span class="line"><span style="color:#24292E;">worker.</span><span style="color:#6F42C1;">unref</span><span style="color:#24292E;">();</span></span></code></pre></div><p>æ³¨æ„ï¼š<code>worker.unref()</code>åœ¨æµè§ˆå™¨ä¸­ä¸å¯ç”¨ã€‚</p><h3 id="worker-ref" tabindex="-1"><code>worker.ref()</code> <a class="header-anchor" href="#worker-ref" aria-label="Permalink to &quot;\`worker.ref()\`&quot;">â€‹</a></h3><p>è¦ä½¿è¿›ç¨‹ä¿æŒæ´»åŠ¨çŠ¶æ€ï¼Œç›´åˆ°<code>Worker</code>ç»ˆæ­¢ï¼Œè¯·è°ƒç”¨<code>worker.ref()</code>ã€‚å¼•ç”¨çš„å·¥ä½œçº¿ç¨‹æ˜¯é»˜è®¤è¡Œä¸ºï¼Œä»ç„¶éœ€è¦äº‹ä»¶</p><p>å¾ªç¯ä¸­å‘ç”Ÿçš„æŸäº›äº‹æƒ…ï¼ˆä¾‹å¦‚<code>&quot;message&quot;</code>ç›‘å¬å™¨ï¼‰ä»¥ä½¿å·¥ä½œçº¿ç¨‹ç»§ç»­è¿è¡Œã€‚</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">worker</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Worker</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">URL</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;worker.ts&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">import</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">meta</span><span style="color:#E1E4E8;">.url).href);</span></span>
<span class="line"><span style="color:#E1E4E8;">worker.</span><span style="color:#B392F0;">unref</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#6A737D;">// ç¨å...</span></span>
<span class="line"><span style="color:#E1E4E8;">worker.</span><span style="color:#B392F0;">ref</span><span style="color:#E1E4E8;">();</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">worker</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Worker</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">URL</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;worker.ts&quot;</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">import</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">meta</span><span style="color:#24292E;">.url).href);</span></span>
<span class="line"><span style="color:#24292E;">worker.</span><span style="color:#6F42C1;">unref</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#6A737D;">// ç¨å...</span></span>
<span class="line"><span style="color:#24292E;">worker.</span><span style="color:#6F42C1;">ref</span><span style="color:#24292E;">();</span></span></code></pre></div><p>æˆ–è€…ï¼Œæ‚¨è¿˜å¯ä»¥å‘<code>Worker</code>ä¼ é€’ä¸€ä¸ª<code>options</code>å¯¹è±¡ï¼š</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">worker</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Worker</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">URL</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;worker.ts&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">import</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">meta</span><span style="color:#E1E4E8;">.url).href, {</span></span>
<span class="line"><span style="color:#E1E4E8;">  ref: </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">worker</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Worker</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">URL</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;worker.ts&quot;</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">import</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">meta</span><span style="color:#24292E;">.url).href, {</span></span>
<span class="line"><span style="color:#24292E;">  ref: </span><span style="color:#005CC5;">false</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">});</span></span></code></pre></div><p>æ³¨æ„ï¼š<code>worker.ref()</code>åœ¨æµè§ˆå™¨ä¸­ä¸å¯ç”¨ã€‚</p><h2 id="ä½¿ç”¨smolèŠ‚çœå†…å­˜" tabindex="-1">ä½¿ç”¨<code>smol</code>èŠ‚çœå†…å­˜ <a class="header-anchor" href="#ä½¿ç”¨smolèŠ‚çœå†…å­˜" aria-label="Permalink to &quot;ä½¿ç”¨\`smol\`èŠ‚çœå†…å­˜&quot;">â€‹</a></h2><p>JavaScript å®ä¾‹å¯èƒ½ä¼šå ç”¨å¤§é‡å†…å­˜ã€‚Bun çš„<code>Worker</code>æ”¯æŒ<code>smol</code>æ¨¡å¼ï¼Œå¯ä»¥å‡å°‘å†…å­˜ä½¿ç”¨ï¼Œä½†ä¼šé™ä½æ€§èƒ½ã€‚è¦å¯ç”¨<code>smol</code>æ¨¡å¼ï¼Œè¯·åœ¨<code>Worker</code>æ„é€ å‡½æ•°çš„<code>options</code>å¯¹è±¡ä¸­ä¼ é€’<code>smol: true</code>ã€‚</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">worker</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Worker</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;./i-am-smol.ts&quot;</span><span style="color:#E1E4E8;">, {</span></span>
<span class="line"><span style="color:#E1E4E8;">  smol: </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">worker</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Worker</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;./i-am-smol.ts&quot;</span><span style="color:#24292E;">, {</span></span>
<span class="line"><span style="color:#24292E;">  smol: </span><span style="color:#005CC5;">true</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">});</span></span></code></pre></div><details><summary>\`smol\`æ¨¡å¼å®é™…ä¸Šæ˜¯ä»€ä¹ˆï¼Ÿ?</summary> è®¾ç½®\`smol: true\`ä¼šå°†\`JSC::HeapSize\`è®¾ç½®ä¸º\`Small\`ï¼Œè€Œä¸æ˜¯é»˜è®¤çš„\`Large\`ã€‚ </details>`,52),p=[e];function r(t,c,E,y,i,d){return a(),n("div",null,p)}const F=s(l,[["render",r]]);export{k as __pageData,F as default};
