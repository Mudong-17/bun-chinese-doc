import{_ as a,o as l,c as p,Q as n,k as s}from"./chunks/framework.33544f09.js";const m=JSON.parse('{"title":"Benchmarking","description":"","frontmatter":{"outline":"deep"},"headers":[],"relativePath":"project/benchmarking.md","filePath":"project/benchmarking.md"}'),o={name:"project/benchmarking.md"},e=n(`<h1 id="benchmarking" tabindex="-1">Benchmarking <a class="header-anchor" href="#benchmarking" aria-label="Permalink to &quot;Benchmarking&quot;">​</a></h1><p>Bun 旨在提供高性能。它对性能关键路径进行了广泛的性能分析和基准测试。Bun 的所有公共基准测试的源代码可以在 Bun 存储库的 <a href="https://github.com/oven-sh/bun/tree/main/bench" target="_blank" rel="noreferrer"><code>/bench</code></a> 目录中找到。</p><h2 id="测量时间" tabindex="-1">测量时间 <a class="header-anchor" href="#测量时间" aria-label="Permalink to &quot;测量时间&quot;">​</a></h2><p>为了精确测量时间，Bun 提供了两个运行时 API 函数：</p><ol><li>Web 标准的<a href="https://developer.mozilla.org/en-US/docs/Web/API/Performance/now" target="_blank" rel="noreferrer"><code>performance.now()</code></a>函数。</li><li><code>Bun.nanoseconds()</code>类似于<code>performance.now()</code>，但它返回自应用程序启动以来的纳秒数。您可以使用<code>performance.timeOrigin</code>将此值转换为 Unix 时间戳。</li></ol><h2 id="基准测试工具" tabindex="-1">基准测试工具 <a class="header-anchor" href="#基准测试工具" aria-label="Permalink to &quot;基准测试工具&quot;">​</a></h2><p>在编写自己的基准测试时，选择正确的工具非常重要。</p><ul><li>对于微基准测试，一个很好的通用工具是<a href="https://github.com/evanwashere/mitata" target="_blank" rel="noreferrer"><code>mitata</code></a>。</li><li>对于负载测试，您必须使用至少与<code>Bun.serve()</code>一样快的 HTTP 基准测试工具，否则结果将不准确。一些流行的基于 Node.js 的基准测试工具，如<a href="https://github.com/mcollina/autocannon" target="_blank" rel="noreferrer"><code>autocannon</code></a>，速度不够快。我们建议使用以下之一： <ul><li><a href="https://github.com/codesenberg/bombardier" target="_blank" rel="noreferrer"><code>bombardier</code></a></li><li><a href="https://github.com/hatoo/oha" target="_blank" rel="noreferrer"><code>oha</code></a></li><li><a href="https://github.com/uNetworking/uSockets/blob/master/examples/http_load_test.c" target="_blank" rel="noreferrer"><code>http_load_test</code></a></li></ul></li><li>对于基准测试脚本或 CLI 命令，我们建议使用<a href="https://github.com/sharkdp/hyperfine" target="_blank" rel="noreferrer"><code>hyperfine</code></a>。</li></ul><h2 id="测量内存使用" tabindex="-1">测量内存使用 <a class="header-anchor" href="#测量内存使用" aria-label="Permalink to &quot;测量内存使用&quot;">​</a></h2><p>Bun 有两个堆栈。一个堆栈用于 JavaScript 运行时，另一个堆栈用于其他一切。</p><h3 id="javascript-堆栈统计" tabindex="-1">JavaScript 堆栈统计 <a class="header-anchor" href="#javascript-堆栈统计" aria-label="Permalink to &quot;JavaScript 堆栈统计&quot;">​</a></h3><p><code>bun:jsc</code>模块公开了一些用于测量内存使用的函数：</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { heapStats } </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;bun:jsc&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">heapStats</span><span style="color:#E1E4E8;">());</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { heapStats } </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;bun:jsc&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">heapStats</span><span style="color:#24292E;">());</span></span></code></pre></div><details><summary>查看示例统计信息</summary><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">heapSize</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1657575</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">heapCapacity</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">2872775</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">extraMemorySize</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">598199</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">objectCount</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">13790</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">protectedObjectCount</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">62</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">globalObjectCount</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">protectedGlobalObjectCount</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// 堆栈中每种对象类型的计数</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">objectTypeCounts</span><span style="color:#E1E4E8;">: {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">CallbackObject</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">25</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">FunctionExecutable</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">2078</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">AsyncGeneratorFunction</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&#39;RegExp String Iterator&#39;</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">FunctionCodeBlock</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">188</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">ModuleProgramExecutable</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">13</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">String</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">UnlinkedModuleProgramCodeBlock</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">13</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">JSON</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">AsyncGenerator</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">Symbol</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">GetterSetter</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">68</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">ImportMeta</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">10</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">DOMAttributeGetterSetter</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">UnlinkedFunctionCodeBlock</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">174</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">RegExp</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">52</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">ModuleLoader</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">Intl</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">WeakMap</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">Generator</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">PropertyTable</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">95</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&#39;Array Iterator&#39;</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">JSLexicalEnvironment</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">75</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">UnlinkedFunctionExecutable</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">2067</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">WeakSet</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">console</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">Map</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">SparseArrayValueMap</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">14</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">StructureChain</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">19</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">Set</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">18</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&#39;String Iterator&#39;</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">FunctionRareData</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">JSGlobalLexicalEnvironment</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">Object</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">481</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">BigInt</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">StructureRareData</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">55</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">Array</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">179</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">AbortController</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">ModuleNamespaceObject</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">11</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">ShadowRealm</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&#39;Immutable Butterfly&#39;</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">103</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">Primordials</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&#39;Set Iterator&#39;</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">JSGlobalProxy</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">AsyncFromSyncIterator</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">ModuleRecord</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">13</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">FinalizationRegistry</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">AsyncIterator</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">InternalPromise</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">22</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">Iterator</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">CustomGetterSetter</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">65</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">Promise</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">19</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">WeakRef</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">InternalPromisePrototype</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">Function</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">2381</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">AsyncFunction</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">GlobalObject</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">ArrayBuffer</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">Boolean</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">Math</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">CallbackConstructor</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">Error</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">JSModuleEnvironment</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">13</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">WebAssembly</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">HashMapBucket</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">300</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">Callee</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">symbol</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">37</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">string</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">2484</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">Performance</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">ModuleProgramCodeBlock</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">12</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">JSSourceCode</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">13</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">JSPropertyNameEnumerator</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">NativeExecutable</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">290</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">Number</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">Structure</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1550</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">SymbolTable</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">108</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">GeneratorFunction</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&#39;Map Iterator&#39;</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#E1E4E8;">  },</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">protectedObjectTypeCounts</span><span style="color:#E1E4E8;">: {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">CallbackConstructor</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">BigInt</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">RegExp</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">GlobalObject</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">UnlinkedModuleProgramCodeBlock</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">13</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">HashMapBucket</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">Structure</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">41</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">JSPropertyNameEnumerator</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">heapSize</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1657575</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">heapCapacity</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">2872775</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">extraMemorySize</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">598199</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">objectCount</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">13790</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">protectedObjectCount</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">62</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">globalObjectCount</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">protectedGlobalObjectCount</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">// 堆栈中每种对象类型的计数</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">objectTypeCounts</span><span style="color:#24292E;">: {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">CallbackObject</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">25</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">FunctionExecutable</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">2078</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">AsyncGeneratorFunction</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">2</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&#39;RegExp String Iterator&#39;</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">FunctionCodeBlock</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">188</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">ModuleProgramExecutable</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">13</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">String</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">UnlinkedModuleProgramCodeBlock</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">13</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">JSON</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">AsyncGenerator</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">Symbol</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">GetterSetter</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">68</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">ImportMeta</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">10</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">DOMAttributeGetterSetter</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">UnlinkedFunctionCodeBlock</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">174</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">RegExp</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">52</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">ModuleLoader</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">Intl</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">WeakMap</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">4</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">Generator</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">2</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">PropertyTable</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">95</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&#39;Array Iterator&#39;</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">JSLexicalEnvironment</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">75</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">UnlinkedFunctionExecutable</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">2067</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">WeakSet</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">console</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">Map</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">23</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">SparseArrayValueMap</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">14</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">StructureChain</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">19</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">Set</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">18</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&#39;String Iterator&#39;</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">FunctionRareData</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">3</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">JSGlobalLexicalEnvironment</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">Object</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">481</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">BigInt</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">2</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">StructureRareData</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">55</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">Array</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">179</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">AbortController</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">2</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">ModuleNamespaceObject</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">11</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">ShadowRealm</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&#39;Immutable Butterfly&#39;</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">103</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">Primordials</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&#39;Set Iterator&#39;</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">JSGlobalProxy</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">AsyncFromSyncIterator</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">ModuleRecord</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">13</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">FinalizationRegistry</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">AsyncIterator</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">InternalPromise</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">22</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">Iterator</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">CustomGetterSetter</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">65</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">Promise</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">19</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">WeakRef</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">InternalPromisePrototype</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">Function</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">2381</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">AsyncFunction</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">2</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">GlobalObject</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">ArrayBuffer</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">2</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">Boolean</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">Math</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">CallbackConstructor</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">Error</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">2</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">JSModuleEnvironment</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">13</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">WebAssembly</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">HashMapBucket</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">300</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">Callee</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">3</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">symbol</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">37</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">string</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">2484</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">Performance</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">ModuleProgramCodeBlock</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">12</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">JSSourceCode</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">13</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">JSPropertyNameEnumerator</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">3</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">NativeExecutable</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">290</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">Number</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">Structure</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1550</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">SymbolTable</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">108</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">GeneratorFunction</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">2</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&#39;Map Iterator&#39;</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1</span></span>
<span class="line"><span style="color:#24292E;">  },</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">protectedObjectTypeCounts</span><span style="color:#24292E;">: {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">CallbackConstructor</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">BigInt</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">RegExp</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">2</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">GlobalObject</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">UnlinkedModuleProgramCodeBlock</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">13</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">HashMapBucket</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">2</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">Structure</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">41</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">JSPropertyNameEnumerator</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1</span></span>
<span class="line"><span style="color:#24292E;">  }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div></details><p>JavaScript 是一种垃圾回收的语言，不是引用计数。对象不会立即在所有情况下被释放是正常的和正确的，尽管对象永远不会被释放不正常。</p><p>要强制手动运行垃圾回收：</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">Bun.</span><span style="color:#B392F0;">gc</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">); </span><span style="color:#6A737D;">// 同步</span></span>
<span class="line"><span style="color:#E1E4E8;">Bun.</span><span style="color:#B392F0;">gc</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;">); </span><span style="color:#6A737D;">// 异步</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">Bun.</span><span style="color:#6F42C1;">gc</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">true</span><span style="color:#24292E;">); </span><span style="color:#6A737D;">// 同步</span></span>
<span class="line"><span style="color:#24292E;">Bun.</span><span style="color:#6F42C1;">gc</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">false</span><span style="color:#24292E;">); </span><span style="color:#6A737D;">// 异步</span></span></code></pre></div><p>堆栈快照可让您检查未被释放的对象。您可以使用\`bun:jsc</p><p>\`模块创建堆栈快照，然后在 Safari 或 WebKit GTK 开发工具中查看它。生成堆栈快照：</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { generateHeapSnapshot } </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;bun&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">snapshot</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">generateHeapSnapshot</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> Bun.</span><span style="color:#B392F0;">write</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;heap.json&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">JSON</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">stringify</span><span style="color:#E1E4E8;">(snapshot, </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">));</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { generateHeapSnapshot } </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;bun&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">snapshot</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">generateHeapSnapshot</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#D73A49;">await</span><span style="color:#24292E;"> Bun.</span><span style="color:#6F42C1;">write</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;heap.json&quot;</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">JSON</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">stringify</span><span style="color:#24292E;">(snapshot, </span><span style="color:#005CC5;">null</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">2</span><span style="color:#24292E;">));</span></span></code></pre></div><p>要查看快照，请在 Safari 的开发工具中打开<code>heap.json</code>文件。</p><ol><li>打开开发者工具</li><li>点击&quot;时间轴&quot;。</li><li>在左侧菜单中点击&quot;JavaScript 分配&quot;。在您点击鉛笔图标以显示所有时间轴之前，可能不可见。</li><li>点击&quot;导入&quot;并选择堆栈快照 JSON 文件。</li></ol>`,22),c=s("image",{alt:"Import heap json",src:"https://user-images.githubusercontent.com/709451/204428943-ba999e8f-8984-4f23-97cb-b4e3e280363e.png",caption:"Importing a heap snapshot"},null,-1),t=s("p",null,"查看后，您应该看到类似于这样的内容：",-1),r=s("image",{alt:"在Safari中查看堆栈快照",src:"https://user-images.githubusercontent.com/709451/204429337-b0d8935f-3509-4071-b991-217794d1fb27.png",caption:"在Safari Dev Tools中查看堆栈快照"},null,-1),E=n(`<h3 id="本地堆栈统计" tabindex="-1">本地堆栈统计 <a class="header-anchor" href="#本地堆栈统计" aria-label="Permalink to &quot;本地堆栈统计&quot;">​</a></h3><p>Bun 使用 mimalloc 用于另一个堆栈。要报告非 JavaScript 内存使用的摘要，请设置<code>MIMALLOC_SHOW_STATS=1</code>环境变量。并在退出时打印统计信息。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#79B8FF;">MIMALLOC_SHOW_STATS</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> bun script.js</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;"># will show something like </span><span style="color:#B392F0;">this</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">heap </span><span style="color:#B392F0;">stats</span><span style="color:#E1E4E8;">:    peak      total      freed    current       unit      count</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">reserved</span><span style="color:#E1E4E8;">:   </span><span style="color:#79B8FF;">64.0</span><span style="color:#E1E4E8;"> MiB   </span><span style="color:#79B8FF;">64.0</span><span style="color:#E1E4E8;"> MiB      </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">64.0</span><span style="color:#E1E4E8;"> MiB                        not all freed</span><span style="color:#F97583;">!</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">committed</span><span style="color:#E1E4E8;">:   </span><span style="color:#79B8FF;">64.0</span><span style="color:#E1E4E8;"> MiB   </span><span style="color:#79B8FF;">64.0</span><span style="color:#E1E4E8;"> MiB      </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">64.0</span><span style="color:#E1E4E8;"> MiB                        not all freed</span><span style="color:#F97583;">!</span></span>
<span class="line"><span style="color:#E1E4E8;">     </span><span style="color:#B392F0;">reset</span><span style="color:#E1E4E8;">:      </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">                            ok</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">touched</span><span style="color:#E1E4E8;">:  </span><span style="color:#79B8FF;">128.5</span><span style="color:#E1E4E8;"> KiB  </span><span style="color:#79B8FF;">128.5</span><span style="color:#E1E4E8;"> KiB    </span><span style="color:#79B8FF;">5.4</span><span style="color:#E1E4E8;"> MiB   </span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">5.3</span><span style="color:#E1E4E8;"> MiB                        ok</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">segments</span><span style="color:#E1E4E8;">:      </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">                            not all freed</span><span style="color:#F97583;">!</span></span>
<span class="line"><span style="color:#F97583;">-</span><span style="color:#B392F0;">abandoned</span><span style="color:#E1E4E8;">:      </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">                            ok</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">-</span><span style="color:#B392F0;">cached</span><span style="color:#E1E4E8;">:      </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">                            ok</span></span>
<span class="line"><span style="color:#E1E4E8;">     </span><span style="color:#B392F0;">pages</span><span style="color:#E1E4E8;">:      </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">         </span><span style="color:#79B8FF;">53</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">53</span><span style="color:#E1E4E8;">                            ok</span></span>
<span class="line"><span style="color:#F97583;">-</span><span style="color:#B392F0;">abandoned</span><span style="color:#E1E4E8;">:      </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">                            ok</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#B392F0;">extended</span><span style="color:#E1E4E8;">:      </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#B392F0;">noretire</span><span style="color:#E1E4E8;">:      </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#E1E4E8;">     </span><span style="color:#B392F0;">mmaps</span><span style="color:#E1E4E8;">:      </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">commits</span><span style="color:#E1E4E8;">:      </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">threads</span><span style="color:#E1E4E8;">:      </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">                            ok</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">searches</span><span style="color:#E1E4E8;">:     </span><span style="color:#79B8FF;">0.0</span><span style="color:#E1E4E8;"> avg</span></span>
<span class="line"><span style="color:#E1E4E8;">numa </span><span style="color:#B392F0;">nodes</span><span style="color:#E1E4E8;">:       </span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">elapsed</span><span style="color:#E1E4E8;">:       </span><span style="color:#79B8FF;">0.068</span><span style="color:#E1E4E8;"> s</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">process</span><span style="color:#E1E4E8;">: </span><span style="color:#B392F0;">user</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">0.061</span><span style="color:#E1E4E8;"> s, </span><span style="color:#B392F0;">system</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">0.014</span><span style="color:#E1E4E8;"> s, </span><span style="color:#B392F0;">faults</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">, </span><span style="color:#B392F0;">rss</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">57.4</span><span style="color:#E1E4E8;"> MiB, </span><span style="color:#B392F0;">commit</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">64.0</span><span style="color:#E1E4E8;"> MiB</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#005CC5;">MIMALLOC_SHOW_STATS</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> bun script.js</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;"># will show something like </span><span style="color:#6F42C1;">this</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">heap </span><span style="color:#6F42C1;">stats</span><span style="color:#24292E;">:    peak      total      freed    current       unit      count</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">reserved</span><span style="color:#24292E;">:   </span><span style="color:#005CC5;">64.0</span><span style="color:#24292E;"> MiB   </span><span style="color:#005CC5;">64.0</span><span style="color:#24292E;"> MiB      </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">       </span><span style="color:#005CC5;">64.0</span><span style="color:#24292E;"> MiB                        not all freed</span><span style="color:#D73A49;">!</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6F42C1;">committed</span><span style="color:#24292E;">:   </span><span style="color:#005CC5;">64.0</span><span style="color:#24292E;"> MiB   </span><span style="color:#005CC5;">64.0</span><span style="color:#24292E;"> MiB      </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">       </span><span style="color:#005CC5;">64.0</span><span style="color:#24292E;"> MiB                        not all freed</span><span style="color:#D73A49;">!</span></span>
<span class="line"><span style="color:#24292E;">     </span><span style="color:#6F42C1;">reset</span><span style="color:#24292E;">:      </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">                            ok</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">touched</span><span style="color:#24292E;">:  </span><span style="color:#005CC5;">128.5</span><span style="color:#24292E;"> KiB  </span><span style="color:#005CC5;">128.5</span><span style="color:#24292E;"> KiB    </span><span style="color:#005CC5;">5.4</span><span style="color:#24292E;"> MiB   </span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">5.3</span><span style="color:#24292E;"> MiB                        ok</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">segments</span><span style="color:#24292E;">:      </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">                            not all freed</span><span style="color:#D73A49;">!</span></span>
<span class="line"><span style="color:#D73A49;">-</span><span style="color:#6F42C1;">abandoned</span><span style="color:#24292E;">:      </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">                            ok</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;">-</span><span style="color:#6F42C1;">cached</span><span style="color:#24292E;">:      </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">                            ok</span></span>
<span class="line"><span style="color:#24292E;">     </span><span style="color:#6F42C1;">pages</span><span style="color:#24292E;">:      </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">         </span><span style="color:#005CC5;">53</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">53</span><span style="color:#24292E;">                            ok</span></span>
<span class="line"><span style="color:#D73A49;">-</span><span style="color:#6F42C1;">abandoned</span><span style="color:#24292E;">:      </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">                            ok</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#6F42C1;">extended</span><span style="color:#24292E;">:      </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#6F42C1;">noretire</span><span style="color:#24292E;">:      </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#24292E;">     </span><span style="color:#6F42C1;">mmaps</span><span style="color:#24292E;">:      </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">commits</span><span style="color:#24292E;">:      </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">threads</span><span style="color:#24292E;">:      </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">                            ok</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">searches</span><span style="color:#24292E;">:     </span><span style="color:#005CC5;">0.0</span><span style="color:#24292E;"> avg</span></span>
<span class="line"><span style="color:#24292E;">numa </span><span style="color:#6F42C1;">nodes</span><span style="color:#24292E;">:       </span><span style="color:#005CC5;">1</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">elapsed</span><span style="color:#24292E;">:       </span><span style="color:#005CC5;">0.068</span><span style="color:#24292E;"> s</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">process</span><span style="color:#24292E;">: </span><span style="color:#6F42C1;">user</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">0.061</span><span style="color:#24292E;"> s, </span><span style="color:#6F42C1;">system</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">0.014</span><span style="color:#24292E;"> s, </span><span style="color:#6F42C1;">faults</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">, </span><span style="color:#6F42C1;">rss</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">57.4</span><span style="color:#24292E;"> MiB, </span><span style="color:#6F42C1;">commit</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">64.0</span><span style="color:#24292E;"> MiB</span></span></code></pre></div>`,3),y=[e,c,t,r,E];function F(i,C,B,u,d,h){return l(),p("div",null,y)}const g=a(o,[["render",F]]);export{m as __pageData,g as default};
